<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="./assets/style.css" rel="stylesheet">
</head>

<body>
    <section class="Section">
        <div class="SectionTop">
            <div>
                <h1>Calculator</h1>
                <h2>With Eng.RH</h2>
            </div>
            <div class="leftSection">
                <button id="points">ðŸ“œ</button>
                <button id="themeBtn">ðŸŒ™</button>
            </div>
        </div>
        <div id="first-div">
            <textarea type="text" id="Result" placeholder="Start ðŸ¤—.." readonly></textarea>
            <button id="cos" data_val="cos(">cos</button>
            <button id="sin" data_val="sin(">sin</button>
            <button id="tan" data_val="tan(">tan</button>
            <button id="cot" data_val="cot(">cot</button>
            <button id="ln" data_val="log(">ln</button>
            <button id="log" data_val="log10(">log</button>
            <button id="power" data_val="^">x^y</button>
            <button id="sqrt" data_val="sqrt(">âˆš</button>
            <button class="num">1</button>
            <button class="num">2</button>
            <button class="num">3</button>
            <button id="plus">+</button>
            <button class="num">4</button>
            <button class="num">5</button>
            <button class="num">6</button>
            <button id="minus">-</button>
            <button class="num">7</button>
            <button class="num">8</button>
            <button class="num">9</button>
            <button id="brod">*</button>
            <button id="e" data_val="e">e</button>
            <button class="num">0</button>
            <button id="mod">%</button>
            <button id="divide">/</button>
            <button id="point">.</button>
            <button id="equal">=</button>
            <button id="bracket1">(</button>
            <button id="bracket2">)</button>
            <button id="fact" data_val="!">x!</button>
            <button id="pi" data_val="pi">pi</button>
            <button id="back">Del</i></button>
            <button id="clear">C</button>
        </div>
        <div id="history">
            <h3>History : </h3>
            <div id="historyList"></div>
            <button id="clearHistory">Clear History</button>
        </div>
    </section>
    <script src="https://cdn.jsdelivr.net/npm/mathjs@14.8.1/lib/browser/math.min.js"></script>
    <script>
        let Results = document.getElementById('Result')
        let Div = document.getElementById('first-div')
        Div.addEventListener('click', (e) => {
            if (e.target.nodeName == 'BUTTON') {
                switch (e.target.textContent) {
                    case 'C':
                        Clear();
                        break
                    case 'Del':
                        Backspace();
                        break
                    case '=':
                        Answer();
                        break
                    default: {
                        let r = e.target.getAttribute('data_val') || e.target.textContent
                        AddToInput(r)
                    }
                }
            }
        })
        function Clear() {
            Results.value = ""
        }
        function Backspace() {
            let Back = Results.value
            Results.value = Back.substring(0, Back.length - 1)
        }
        function AddToInput(y) {
            Results.value += y
        }
        //color_cahnge_mood
        let themeBtn = document.getElementById("themeBtn");
        themeBtn.addEventListener("click", () => {
            document.body.classList.toggle("dark-mode");
        });
        function Answer() {
            let expr = Results.value
            try {
                if (/log\((-?\d+(\.\d+)?)\)/.test(expr)) {
                    let num = parseFloat(expr.match(/log\((-?\d+(\.\d+)?)\)/)[1])
                    if (num <= 0) throw "error"
                }
                if (/sqrt\((-?\d+(\.\d+)?)\)/.test(expr)) {
                    let num = parseFloat(expr.match(/sqrt\((-?\d+(\.\d+)?)\)/)[1])
                    if (num < 0) throw "error"
                }
                let answer = math.evaluate(expr)
                Results.value = answer
                saveToHistory(expr, answer)
            } catch (error) {
                Results.value = "error"
            }
        }
        function saveToHistory(expr, answer) {
            let history = JSON.parse(localStorage.getItem("calcHistory")) || []
            history.push(`${expr} = ${answer}`)
            localStorage.setItem("calcHistory", JSON.stringify(history))
            renderHistory()
        }
        function renderHistory() {
            let historyList = document.getElementById("historyList")
            historyList.innerHTML = ""
            let history = JSON.parse(localStorage.getItem("calcHistory")) || []
            history.forEach(item => {
                let p = document.createElement("p")
                p.textContent = item
                historyList.appendChild(p)
            })
        }
        document.getElementById("clearHistory").addEventListener("click", () => {
            localStorage.removeItem("calcHistory")
            renderHistory()
        })
        renderHistory()
        let pointsBtn = document.getElementById("points")
        let historyDiv = document.getElementById("history")
        pointsBtn.addEventListener("click", () => {
            if (historyDiv.style.display === "none") {
                historyDiv.style.display = "block"
                Div.style.display = "none"
            } else {
                historyDiv.style.display = "none"
                Div.style.display = "flex"
            }
        })
    </script>
</body>

</html>